# AETG 算法的优化

------



## AETG算法概述：

AETG（Adaptive Efficient Test Generation）算法是一种测试生成算法，用于在给定系统具有K个参数，每个参数ki有li个可能值的情况下生成高效的测试用例集。该算法通过以下步骤实现测试用例的选择和生成：

1. 选择候选组数M（每次生成一个正式的测试用例加入 Cover Array 前，都先生成 M 个候选测试用例，在其中选择最优的）。
2. 选择一个参数fi和值vj，其中vj在未覆盖对中具有最高频率。
3. 将fi选择为f1，并对剩余参数进行随机排列。
4. 假设f1-fj已分配，为fj+1分配vj+1，vj+1具有与所有已分配参数的未覆盖对最多的数量。
5. 循环执行步骤1-4以获得M个候选项，并找到最优解，添加到测试用例集（CA，也即Cover Array）中。
6. 重复执行步骤1-5直到所有未覆盖对都被覆盖，成功生成测试用例集。

> 其中对于步骤4，细化如下：
>
> 在步骤4中，假设已确定了t-1个参数，接下来随机选择一个未确定的参数kt。这一步分两种情况：
>
> 1. 当 t <= T 时（测试组的参数数量未达到指定的强度）：
>    - 对kt的所有可能取值进行遍历，将每个取值与已确定的所有参数进行组合。此时的组合仍然比一个未覆盖对（Uncovered Pairs）还小。
>    - 遍历所有未覆盖对，确定包含这个组合的未覆盖对数量。选取包含这个组合的未覆盖对数量最大的情况下，将kt的取值作为该参数的实际值。
> 2. 当 t > T 时（测试组的参数数量已达到指定的强度）：
>    - 对kt的所有可能取值进行遍历，对于每个可能取值，需要从已确定的t-1个参数中选择T-1个进行组合，与当前取值组合，得到一个与未覆盖对集（Uncovered Pairs）相当大小的组合。
>    - 判断该组合是否是未覆盖对集中的一种情况。由于有（从t-1中选T-1）个选取方案，将覆盖的未覆盖对数量相加得到总数。
>    - 在总数最大的情况下，将kt的取值作为该参数的实际值。
>
> 这样，在每一步中，通过随机选择未确定参数kt，并根据测试组的参数数量是否达到指定的强度，选择合适的策略来确定参数的实际值，以最优化地生成测试用例。



### 数据格式

测试用例形式：[12, 4, 2, 21] 表示一个4 factors 的测试用例，其中列表中的每一项都代表了对应factor可以取到的value数量。

候选组形式：对于上面的测试用例，每一个候选组的形式如下：[3, 0, 1, 19]，其中列表的每一项都代表了取对应factor的某一个value的值（注意，value从0开始，所以最大只能取到 len(value<sub>i</sub>) - 1  ）

覆盖对形式：对于上面的测试用例，一个2元变量的覆盖对形式如下：[-1, 0, -1, 19]，其中-1代表对应factor未被选择，而非负整数代表对应factor的value取值映射



### 优化处理

#### 当存在重复的局部最优时，随机选择

AETG 本身是一个贪心的算法，其算法执行过程中是很有可能出现多个局部最优取值的情况。每次碰到这种情况，我都是采用一个best_group来存储所有的局部最优解，然后随机从中选择一个作为这次处理过程的取值。



#### 循环多次取最优

除了每次都要生成M个候选组，然后从中取最优，我还对整个程序循环R次，然后取Cover Array 数量最少的情况，然后写入csv文件。在我的程序中，M 和 R可以自己设置，M 和 R 越大，相应的结果越接近最优情况，但是同样的程序运行时间也会增长。在我的程序中，我设置的M 和 R 分别为 50 和 10，其中对于京东的测试用例我采用了 t = 2 的情况，而携程我采用了 t = 3 的情况，相应的cover array结果也已写入对应的csv文件中。对于携程的测试结果，经过判定，发现其结果是满足条件的，这样证明了我的算法是通用的（不只是对 t = 2成立）



### 测试结果

京东建模测试结果（t=2）：所需最少的cover array 组数为 273组

[jingdong.csv](./jingdong.csv)

携程建模测试结果（t=3）：所需最少cover array 组数为 199 组

[xiecheng.csv](./xiecheng.csv)

> 由于采用了多次随机取最优的处理方式，因而每次运行程序得出的结果都可能不一样，多次运行之后可能能得到更好地结果



## 参考链接

[为什么需要组合覆盖 why t-way coverage - turtle_fly - 博客园 (cnblogs.com)](https://www.cnblogs.com/turtle-fly/articles/2797815.html)

[The Automatic Efficient Test Generator (AETG) system | IEEE Conference Publication | IEEE Xplore](https://ieeexplore.ieee.org/document/341392/;jsessionid=HT8Apx1SX_mRDtoR-lzawk4879AO7Bnox5e8_R_NqWoQU8zZkOV9!1155132918)

[[简述覆盖表（Covering Arrays） - 电子羊 - 博客园 (cnblogs.com)](https://www.cnblogs.com/StudioLux/p/9073353.html)]()

